# Contributor: Oleksiy Zakharov <alexzkhr@gmail.com>
pkgname=VC4C
pkgver=0.4.0
pkgrel=2
pkgdesc="Compiler for the VC4CL OpenCL implementation"

provides=('VC4C')
arch=('i686' 'x86_64' 'arm' 'armv6h')
url="git://github.com/doe300/VC4C"

license=('MIT')
depends=(llvm clang)
makedepends=(cmake)
source=(git://github.com/doe300/VC4C
        git://github.com/doe300/VC4CLStdLib
        isfast.patch)
        
md5sums=('SKIP'
         'SKIP'
         'SKIP')

prepare() {
  cd ${srcdir}/VC4C  
  patch -Np1 -i "${srcdir}/isfast.patch"
}

build() {
  cd ${srcdir}/VC4C
  mkdir -p ${srcdir}/build
  cd ${srcdir}/build
  cmake -DCMAKE_INSTALL_PREFIX=/usr -DMULTI_THREADED=OFF -DBUILD_DEBUG=OFF -DBUILD_DEB_PACKAGE=OFF ../VC4C
  make || return 1
}

package() {
  cd $srcdir/build
  make DESTDIR="$pkgdir/" install
  mkdir -p $pkgdir/usr/include/vc4cl-stdlib
  install -m644 $srcdir/VC4CLStdLib/include/*.* $pkgdir/usr/include/vc4cl-stdlib
}
